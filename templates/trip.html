{% extends "base.html" %}

{% block title %}{{trip.trip_name}}{% endblock %}

{% block head %}

<link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>

{% endblock %}

{% block content %}

<h2>{{trip.trip_name}}</h2>

<h5 class="edit">Trip Accommodations</h5>
<button class="btn btn-link edit" type="button" data-toggle="collapse" data-target="#edit-accom-form" aria-expanded="false" aria-controls="collapseExample">
    Edit
</button>
<p>{{trip.trip_accommodations}}</p>
<div class="collapse" id="edit-accom-form">
    <div class="form-group">
        <input type="text" class="form-control" id="trip_accom" name="trip_accom" value="{{trip.trip_accommodations}}">
        <input type="submit" class="btn btn-primary">
    </div>
</div>

<!-- <h5>Trip Start</h5>
<p>{{trip.trip_start_date}}</p>

<h5>Trip End</h5>
<p>{{trip.trip_end_date}}</p> -->

<h5>Trip Participants</h5>
    <ul>
        {% for trip_user in trip.trip_users %}
            <li>{{trip_user.user.username}}</li>
        {% endfor %}
    </ul>

<div>
    <select name="users[]" multiple="multiple" id="add-users-to-trip">
        {% for user in all_users %}
        <option value={{user.user_id}}>{{user.username}}</option>
        {% endfor %}
    </select>
</div>

<h5>Trip Trails</h5>
{% if trip.trip_trails %}
<ul>
    {% for trip_trail in trip.trip_trails %}
        <li>
            <a href="/trail/{{trip_trail.trail_id}}">{{trip_trail.trail.trail_name}}</a>
            <br>
            <p>Added by {{trip_trail.user.username}}</p>
        </li>
    {% endfor %}
</ul>
{% else %}
<p>No trails added to this trip</p>
{% endif %}
<a href="/search?search={{trip.trip_accommodations}}">
    <button type="button" class="btn btn-primary" id="trip-trail-search-button">
    Search for trails nearby
    </button>
</a>

<div id="tripmapdiv" class="map-container"></div>


<button type="button" class="btn btn-secondary" id="archive-trip">
    Archive this trip
</button>
<button type="button" class="btn btn-secondary hidden" id="unarchive-trip">
    Unarchive this trip
</button>

<a href="/deletetrip/{{trip.trip_id}}">
    <button type="button" class="btn btn-danger" id="delete-trip">
    Delete this trip
    </button>
</a>
<script>
    const archiveButton = $("#archive-trip");
    const unarchiveButton = $("#unarchive-trip");
    const trip_id = {{trip.trip_id}};

    archiveButton.on("click", () => {
        $.post("/archivetrip", {trip_id: trip_id}, (res) => {
            console.log(res);
            archiveButton.addClass("hidden");
            unarchiveButton.removeClass("hidden");
        });
    });
    unarchiveButton.on("click", () => {
        $.post("/unarchivetrip", {trip_id: trip_id}, (res) => {
            console.log(res);
            archiveButton.removeClass("hidden");
            unarchiveButton.addClass("hidden");
        });
    });
</script>
<script src="/static/adduserstotrip.js"></script>
<!-- Script to initialize Google map & place marker -->
<script src="/static/displaytripmap.js"></script>

<!-- Google Maps JS API script -->
<script async defer
  src="https://maps.googleapis.com/maps/api/js?key={{GOOGLE_MAPS_KEY}}&callback=initMap">
</script>
{% endblock %}